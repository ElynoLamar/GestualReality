
from yolov8.test import my_function
from flask import Flask, request, jsonify, make_response
import os
import sys

app = Flask(__name__)

# default upload pasta
UPLOAD_FOLDER = '../uploads'
if not os.path.exists(UPLOAD_FOLDER):
    os.makedirs(UPLOAD_FOLDER)

# Add the path to the ultralytics directory to the Python module search path
sys.path.append(os.path.abspath(os.path.join(
    os.path.dirname(__file__), '..', 'ultralytics')))

# Importar predict yolov8


@app.route('/', methods=['POST'])
def upload_file():
    # receber em formdata propriedade image
    file = request.files['image']
    filename = file.filename
    # preparar caminhos
    filename = os.path.basename(filename)
    filepath = os.path.abspath(os.path.join(
        os.path.dirname(__file__), UPLOAD_FOLDER, filename))
    # grvar file -> previs√£o precisa de ficheiro "fisico"
    file.save(filepath)
    # previsao
    output = my_function(filepath)
    print(output)
    return output
